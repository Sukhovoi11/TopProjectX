<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MiniGram+ ‚Äî Profile</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <meta name="theme-color" content="#1f7cd6">
    <style>
        /* Basic styling for the custom confirmation modal (since styles.css is external) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body data-theme="light">
<header class="topbar">
    <a href="index.html" class="back">‚Üê</a>
    <div class="logo">Profile</div>
    <div style="width:48px"></div>
</header>

<main class="container profile">
    <section class="profile-header">
        <div class="avatar-large" id="user-avatar">üë§</div>
        <div class="profile-info">
            <h3 id="user-name">User</h3>
            <div class="hint" id="user-info">MiniGram+ demo</div>
        </div>
    </section>

    <section class="settings">
        <h4>Settings</h4>
        <div class="setting-row">
            <label>Theme</label>
            <button id="theme-toggle-2" class="small">Toggle</button>
        </div>
        <div class="setting-row">
            <label>Offline Mode</label>
            <div id="online-status-2" class="hint">online</div>
        </div>
        <div class="setting-row">
            <label>Account</label>
            <button id="logout-btn" class="small danger">Log Out</button>
        </div>
    </section>

    <section>
        <h4>My Posts</h4>
        <div id="my-posts" class="feed"></div>
        <div id="empty-my" class="hint">No posts yet</div>
    </section>
</main>

<!-- Custom Confirmation Modal for Logout (Replaces window.confirm) -->
<div id="custom-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h3>Confirm Logout</h3>
        <p>Are you sure you want to log out of your account?</p>
        <div class="modal-actions">
            <button id="modal-cancel" class="small">Cancel</button>
            <button id="modal-confirm" class="small danger">Log Out</button>
        </div>
    </div>
</div>

<script src="db.js"></script>
<script src="app.js"></script>

<script>
    // Check if the user is logged in
    const saved = JSON.parse(localStorage.getItem('mg_user') || '{}');
    if (!saved.user) {
        location.href = 'login.html';
    }

    // Display name and "avatar"
    const userNameEl = document.getElementById('user-name');
    const avatarEl = document.getElementById('user-avatar');
    const infoEl = document.getElementById('user-info');

    if (saved.user) {
        userNameEl.textContent = saved.user;
        avatarEl.textContent = saved.user[0]?.toUpperCase() || 'üë§';
        // Using 'en-US' locale for date display
        infoEl.textContent = 'Active since ' + new Date().toLocaleDateString('en-US');
    }

    // Logout button logic (now uses custom modal)
    const logoutBtn = document.getElementById('logout-btn');
    const customModal = document.getElementById('custom-modal');
    const modalConfirmBtn = document.getElementById('modal-confirm');
    const modalCancelBtn = document.getElementById('modal-cancel');

    // Show modal when logout button is clicked
    logoutBtn.onclick = () => {
        customModal.classList.remove('hidden');
    };

    // Handle modal actions
    modalCancelBtn.onclick = () => {
        customModal.classList.add('hidden');
    };

    modalConfirmBtn.onclick = () => {
        // Perform logout
        localStorage.removeItem('mg_user');
        location.href = 'login.html';
        customModal.classList.add('hidden');
    };
</script>
</body>
</html>
